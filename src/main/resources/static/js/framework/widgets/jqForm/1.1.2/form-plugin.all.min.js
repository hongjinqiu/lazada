!function(e){"use strict";e.jForm=e.jForm||{};var t={view:{focusSelectText:!0},callback:{beforeSetValue:null,afterSetValue:null,afterGetValue:null,afterDisableElement:null,afterEnableElement:null,afterClick:null,afterFocus:null,afterBlur:null,afterKeyup:null,afterChange:null,afterReset:null},formatter:[],_defaultFormDataStore:{},_defaultFormData:null,_formDataStore:{},_ignoreSetValueFiledNames:[],_isSetValue:!1};e.fn.jqForm=function(n){if("string"==typeof n){var r=e.jForm.getAccessor(e.jForm,n);if(!r)return void alert("$.jForm - method not found:"+n);var l=e.makeArray(arguments).slice(1);return r.apply(this,l)}return n=e.extend(!0,{},t,n),this.each(function(){if(!this.renderCompleted){var r=this;if(e(r).is("form")!==!0)return void alert("Non(form)controls can't initialize!");r.p=e.extend(!0,{id:r.id},e.jForm,t,n),a.call(r),r.renderCompleted=!0}})},e.extend(e.jForm,{getAccessor:function(e,t){var a,n,r,l=[];if("function"==typeof t)return t(e);if(a=e[t],void 0===a)try{if("string"==typeof t&&(l=t.split(".")),r=l.length)for(a=e;a&&r--;)n=l.shift(),a=a[n]}catch(i){}return a},setDefaultValue:function(t,a){return this.each(function(){var n=this,r=n.p,i=e(n);return null!=t&&e.isPlainObject(t)?(i.jqForm("reset",!0),r._defaultFormDataStore=e.extend(!0,{},t),r._formDataStore=e.extend(!0,{},t),void(e.isFunction(r.callback.beforeSetValue)&&r.callback.beforeSetValue.call(n,r._formDataStore)!==!0||(o.call(n,r._formDataStore),l.call(n,r._formDataStore),e.isFunction(r.callback.afterSetValue)&&r.callback.afterSetValue.call(n,r._formDataStore),a&&e.isFunction(a)&&a.apply(n,[r._formDataStore]),r._defaultFormData=i.jqForm("getValue")))):void(console&&console.hasOwnProperty("info")&&console.info("Form data is empty or not JSON object！"))})},setValue:function(t,a){return this.each(function(){var n,r=this,i=e(r),c=r.p;return null!=t&&e.isPlainObject(t)?(n=i.jqForm("getValue"),c._formDataStore=e.extend(!0,{},n,t),void(e.isFunction(c.callback.beforeSetValue)&&c.callback.beforeSetValue.call(r,c._formDataStore)!==!0||(o.call(r,c._formDataStore),l.call(r,c._formDataStore),e.isFunction(c.callback.afterSetValue)&&c.callback.afterSetValue.call(r,c._formDataStore),a&&e.isFunction(a)&&a.apply(r,[c._formDataStore])))):void(console&&console.hasOwnProperty("info")&&console.info("Form data is empty or not JSON object!"))})},getValue:function(t,a){var n={};return this.each(function(){var l=this,i=l.p,o=null,f=null,u=null,s=null;e("[name]",l).each(function(){u=e(this),f=u.attr("name"),s=e("[name='"+u.attr("name")+"']",l),u.is("input[type='radio']")?(o=e("input[name='"+f+"']:checked",l).val(),o=void 0==o?null:o):u.is("input[type='checkbox']")&&1==s.length?(o=e("input[name='"+f+"']:checked",l).val(),o=void 0==o?null:o):s.length>1?(o=[],s.each(function(){var t=e(this);t.is("input[type='checkbox']")&&t.prop("checked")&&o.push(""===e.trim(t.val())?null:t.val())})):o=u.is("input")||u.is("textarea")||u.is("select")?u.val():u.text(),r(n,f,o),s=null}),t===!1||c.call(l,n),n=e.extend({},i._formDataStore,n),e.isFunction(i.callback.afterGetValue)&&i.callback.afterGetValue.call(l,n),a&&e.isFunction(a)&&a.apply(l,[n])}),n},isDirty:function(t){if(0!=this.length){var a,n,r=this[0],l=r.p,i=0,o={};if(l._defaultFormData){if(o=e(r).jqForm("getValue"),!!t==!1){if(a=Object.keys(o).sort(),n=Object.keys(l._defaultFormData).sort(),n.join(",")!==a.join(","))return!0;for(i=0;i<a.length;i++)if(o[a[i]]!=l._defaultFormData[a[i]])return!0;return!1}return o&&JSON.stringify(o)!=JSON.stringify(l._defaultFormData)}return!!l._isSetValue}},reset:function(t){var a,n=function(t){t.reset(),e("[name]",t).each(function(t,n){a=e(n),a.is("input")||a.is("textarea")||a.is("select")?1==a.is("input[type='hidden']")&&a.val(""):a.text("")})};return this.each(function(){var a=this,r=a.p;t===!0?(r._defaultFormDataStore={},r._defaultFormData=null,r._formDataStore={},r._isSetValue=!1,n(a)):r._defaultFormDataStore&&!e.isEmptyObject(r._defaultFormDataStore)?e(a).jqForm("setDefaultValue",r._defaultFormDataStore):(r._defaultFormDataStore={},r._defaultFormData=null,r._formDataStore={},r._isSetValue=!1,n(a)),e.isFunction(r.callback.afterReset)&&r.callback.afterReset.call(a)})},disableElement:function(t,a){return e.isArray(t)?this.each(function(){var n,r,l=this,i=l.p,o=e(l),c={};for(n=0;n<t.length;n++)c=t[n],c.fieldName&&("*"===c.fieldName?o.find("[name]").each(function(t,a){r=e(a),r.is("[type='hidden']")||r.attr({disabled:"disabled"})}):o.find("[name='"+c.fieldName+"']").each(function(t,a){r=e(a),r.is("[type='hidden']")||r.attr({disabled:"disabled"})}));e.isFunction(i.callback.afterDisableElement)&&i.callback.afterDisableElement.call(l,t),a&&e.isFunction(a)&&a.apply(l,[t])}):void(console&&console.hasOwnProperty("info")&&console.info(t+"，Must be an array！"))},enableElement:function(t,a){return e.isArray(t)?this.each(function(){var n,r=this,l=r.p,i=e(r),o={};for(n=0;n<t.length;n++)o=t[n],o.fieldName&&("*"===o.fieldName?i.find("[name]").removeAttr("disabled"):i.find("[name="+o.fieldName+"]").removeAttr("disabled"));e.isFunction(l.callback.afterEnableElement)&&l.callback.afterEnableElement.call(r,t),a&&e.isFunction(a)&&a.apply(r,[t])}):void(console&&console.hasOwnProperty("info")&&console.info(t+"，Must be an array！"))},focusToElement:function(t){return this.each(function(){var a=this;e("[name='"+t+"']",a).focus()})},allowFocusElement:function(){var t=[];return this.each(function(){var a=this;e('input:enabled:not(:checkbox):not(:radio):not(:button):not([readonly="readonly"]):not(:hidden)',a).each(function(){t.push(this)}),t=t.concat(),e('select:enabled:not([readonly="readonly"]):not(:hidden)',a).each(function(){t.push(this)}),e('textarea:enabled:not([readonly="readonly"]):not(:hidden)',a).each(function(){t.push(this)})}),t}});var a=function(){e(this).each(function(){var t,a=this,n=e(a),r=a.p;n.find("[name]").off("click.jqForm"),n.find("[name]").on("click.jqForm",function(l){e.isFunction(r.callback.afterClick)&&(t=n.jqForm("getValue"),r.callback.afterClick.call(a,l,e(this).attr("name"),t))}),n.find("[name]").off("focus.jqForm"),n.find("[name]").on("focus.jqForm",function(l){var i=e(this);if(r.view.focusSelectText&&i.is("input:text")&&!i.prop("disabled")&&!i.prop("readonly"))var o=window.setTimeout(function(){i.is(":focus")&&i.select(),window.clearTimeout(o)},1);e.isFunction(r.callback.afterFocus)&&(t=n.jqForm("getValue"),r.callback.afterFocus.call(a,l,i.attr("name"),t))}),n.find("[name]").off("blur.jqForm"),n.find("[name]").on("blur.jqForm",function(l){e.isFunction(r.callback.afterBlur)&&(t=n.jqForm("getValue"),r.callback.afterBlur.call(a,l,e(this).attr("name"),t))}),n.find("[name]").off("keyup.jqForm"),n.find("[name]").on("keyup.jqForm",function(l){e.isFunction(r.callback.afterKeyup)&&(t=n.jqForm("getValue"),r.callback.afterKeyup.call(a,l,e(this).attr("name"),t))}),n.find("select[name]").off("change.jqForm"),n.find("select[name]").on("change.jqForm",function(l){e.isFunction(r.callback.afterChange)&&(t=n.jqForm("getValue"),r.callback.afterChange.call(a,l,e(this).attr("name"),t))})})},n=function(e,t){var a;if(t.indexOf(".")>-1){var r=t.substring(0,t.indexOf("."));t=t.substring(t.indexOf(".")+1,t.length),a=e.hasOwnProperty(r)?n(e[r],t):void 0}else a=e[t];return a},r=function(e,t,a){if(t.indexOf(".")>-1){var n=t.substring(0,t.indexOf("."));t=t.substring(t.indexOf(".")+1,t.length),e[n]=e[n]||{},r(e[n],t,a)}else e[t]=a},l=function(t){return e(this).each(function(){var a,r,l,i,o,c,f=this,u=f.p,s=0,m=!1;for(u._isSetValue=!0,a=e("[name]",f),c=0;c<a.length;c++){if(r=e(a[c]),l=r.attr("name"),m=!1,l&&l.length>0)for(s=0;s<u._ignoreSetValueFiledNames.length;s++)if(l==u._ignoreSetValueFiledNames[s]){m=!0;break}m||(o=n(t,l),r.is("input[type='radio']")?e("input[name='"+l+"'][value='"+o+"']",f).prop("checked",!0):r.is("input[type='checkbox']")?(i=e.isArray(o)?o:[o],e("input[name='"+l+"']",f).val(i)):r.is("input")||r.is("textarea")||r.is("select")?null!==o&&r.val(o):null!==o&&r.text(o))}})},i=function(t){return e(this).each(function(){var e,a=this,n=a.p,r=!1;for(e=0;e<n._ignoreSetValueFiledNames.length;e++)if(t==n._ignoreSetValueFiledNames[e]){r=!0;break}r===!1&&n._ignoreSetValueFiledNames.push(t)})},o=function(t){return e(this).each(function(){var e=this,a=e.p,l=0,i={},o="";if(a.formatter&&a.formatter.length>0)for(;l<a.formatter.length;l++)i=a.formatter[l],i&&("date"===i.format&&(o=f.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)),"textValue"===i.format&&(o=m.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)),"singleCheckbox"===i.format&&(o=h.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)))})},c=function(t){return e(this).each(function(){var e=this,a=e.p,l=0,i={},o="";if(a.formatter&&a.formatter.length>0)for(;l<a.formatter.length;l++)i=a.formatter[l],i&&("date"===i.format&&(o=u.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)),"textValue"===i.format&&(o=d.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)),"singleCheckbox"===i.format&&(o=p.call(e,i.fieldName,i,n(t,i.fieldName)),r(t,i.fieldName,o)))})},f=function(e,t,a){var n=t.dateFormat||"yyyy-MM-dd",r=function(e,t){var a=new Date(t),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return e};return a?r(n,Number(a)):a},u=function(e,t,a){var n=this,r=t.dateFormat||"yyyy-MM-dd";return a?Date.parse(s.call(n,a,r)):a},s=function(e,t){function a(e){var t=/hh?|HH?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g,a=e.replace(t,"\x00").split("\x00"),n=e.match(t);if(!a||!a.length||!n||0==n.length)throw new Error("Invalid date format.");return{separators:a,parts:n}}if(!e)return e;if(e instanceof Date)return e;var n,r,l,i,o={yyyy:0,M:0,d:0,h:0,m:0,s:0};if(t=a(t),n=e&&e.toString().match(/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g)||[],i={h:function(e){o.h=e},M:function(e){e-=1,o.M=e},m:function(e){o.m=e},s:function(e){o.s=e},yyyy:function(e){o.yyyy=e},yy:function(e){o.yyyy=e},d:function(e){o.d=e}},i.dd=i.d,i.ss=i.s,i.mm=i.m,i.MM=i.M,i.HH=i.H=i.hh=i.h,n.length==t.parts.length)for(var c=0,f=t.parts.length;f>c;c++)r=parseInt(n[c],10),l=t.parts[c],i[t.parts[c]](r);return new Date(o.yyyy,o.M,o.d,o.h,o.m,o.s)},m=function(e,t,a){var n=t.dataMap;if(n)return n[a];throw new Error("dataMap no configuration!")},d=function(e,t,a){var n,r=t.dataMap,l=null;for(n in r)if(r[n]==a){l=n;break}return l},h=function(t,a,n){return e(this).each(function(){var r=this,l=e('input[name="'+t+'"]',r),o=a.dataMap;if(0!=l.length){if(!l.is("input:checkbox"))throw new Error(t+" non checkbox control!");if(!o)throw new Error("dataMap no configuration!");o.checked===n?l.prop("checked",!0):l.prop("checked",!1),i.call(r,t)}}),n},p=function(t,a,n){var r;return e(this).each(function(){var n=this,l=e('input[name="'+t+'"]',n),i=a.dataMap,o=!1;l.length>0&&(o=l.prop("checked"),r=o===!0?i.checked:i.unchecked)}),r}}(jQuery);